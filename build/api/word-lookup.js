"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
var to_exclude = new Set(["wid", "trailer_utf8"]);

var wordLookup = function wordLookup(params, db) {
	return new Promise(function (resolve, reject) {
		// validate param
		if (!params.hasOwnProperty("wid")) {
			reject({ "error": "Invalid request, needs an object like { wid: n }." });
		} else if (!Number.isInteger(params.wid) || params.wid < 1) {
			reject({ "error": "Invalid wid, must be a positive integer." });
		} else {
			var cursor = db.collection("word_data").findOne({ wid: params.wid }, function (err, doc) {
				if (err) {
					console.log("error with wid lookup");
					reject(err);
				}
				if (!doc || !doc.hasOwnProperty("features")) {
					console.log("no doc:", doc);
					reject("wid not found");
				}
				var features = doc["features"];
				to_exclude.forEach(function (e) {
					if (features.hasOwnProperty(e)) delete features[e];
				});
				resolve({
					"wid": params.wid,
					"results": features
				});
			});
		}
	});
};
exports.wordLookup = wordLookup;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hcGkvd29yZC1sb29rdXAuanMiXSwibmFtZXMiOlsidG9fZXhjbHVkZSIsIlNldCIsIndvcmRMb29rdXAiLCJwYXJhbXMiLCJkYiIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiaGFzT3duUHJvcGVydHkiLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJ3aWQiLCJjdXJzb3IiLCJjb2xsZWN0aW9uIiwiZmluZE9uZSIsImVyciIsImRvYyIsImNvbnNvbGUiLCJsb2ciLCJmZWF0dXJlcyIsImZvckVhY2giLCJlIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBLElBQU1BLGFBQWEsSUFBSUMsR0FBSixDQUFRLENBQzFCLEtBRDBCLEVBRTFCLGNBRjBCLENBQVIsQ0FBbkI7O0FBS0EsSUFBTUMsYUFBYSxTQUFiQSxVQUFhLENBQUNDLE1BQUQsRUFBU0MsRUFBVCxFQUFnQjtBQUNsQyxRQUFPLElBQUlDLE9BQUosQ0FBWSxVQUFDQyxPQUFELEVBQVVDLE1BQVYsRUFBcUI7QUFDdkM7QUFDQSxNQUFJLENBQUNKLE9BQU9LLGNBQVAsQ0FBc0IsS0FBdEIsQ0FBTCxFQUFtQztBQUNsQ0QsVUFBTyxFQUFDLFNBQVMsbURBQVYsRUFBUDtBQUNBLEdBRkQsTUFHSyxJQUFJLENBQUNFLE9BQU9DLFNBQVAsQ0FBaUJQLE9BQU9RLEdBQXhCLENBQUQsSUFBaUNSLE9BQU9RLEdBQVAsR0FBYSxDQUFsRCxFQUFxRDtBQUN6REosVUFBTyxFQUFDLFNBQVMsMENBQVYsRUFBUDtBQUNBLEdBRkksTUFHQTtBQUNKLE9BQU1LLFNBQVNSLEdBQUdTLFVBQUgsQ0FBYyxXQUFkLEVBQTJCQyxPQUEzQixDQUFtQyxFQUFFSCxLQUFLUixPQUFPUSxHQUFkLEVBQW5DLEVBQXdELFVBQUNJLEdBQUQsRUFBTUMsR0FBTixFQUFjO0FBQ3BGLFFBQUlELEdBQUosRUFBUztBQUNSRSxhQUFRQyxHQUFSLENBQVksdUJBQVo7QUFDQVgsWUFBT1EsR0FBUDtBQUNBO0FBQ0QsUUFBSSxDQUFDQyxHQUFELElBQVEsQ0FBQ0EsSUFBSVIsY0FBSixDQUFtQixVQUFuQixDQUFiLEVBQTZDO0FBQzVDUyxhQUFRQyxHQUFSLENBQVksU0FBWixFQUF1QkYsR0FBdkI7QUFDQVQsWUFBTyxlQUFQO0FBQ0E7QUFDRCxRQUFJWSxXQUFXSCxJQUFJLFVBQUosQ0FBZjtBQUNBaEIsZUFBV29CLE9BQVgsQ0FBbUIsYUFBSztBQUN2QixTQUFJRCxTQUFTWCxjQUFULENBQXdCYSxDQUF4QixDQUFKLEVBQ0MsT0FBT0YsU0FBU0UsQ0FBVCxDQUFQO0FBQ0QsS0FIRDtBQUlBZixZQUFRO0FBQ1AsWUFBT0gsT0FBT1EsR0FEUDtBQUVQLGdCQUFXUTtBQUZKLEtBQVI7QUFJQSxJQWxCYyxDQUFmO0FBbUJBO0FBQ0QsRUE3Qk0sQ0FBUDtBQThCQSxDQS9CRDtRQWdDU2pCLFUsR0FBQUEsVSIsImZpbGUiOiJ3b3JkLWxvb2t1cC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHRvX2V4Y2x1ZGUgPSBuZXcgU2V0KFtcblx0XCJ3aWRcIixcblx0XCJ0cmFpbGVyX3V0ZjhcIlxuXSlcblxuY29uc3Qgd29yZExvb2t1cCA9IChwYXJhbXMsIGRiKSA9PiB7XG5cdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0Ly8gdmFsaWRhdGUgcGFyYW1cblx0XHRpZiAoIXBhcmFtcy5oYXNPd25Qcm9wZXJ0eShcIndpZFwiKSkge1xuXHRcdFx0cmVqZWN0KHtcImVycm9yXCI6IFwiSW52YWxpZCByZXF1ZXN0LCBuZWVkcyBhbiBvYmplY3QgbGlrZSB7IHdpZDogbiB9LlwifSlcblx0XHR9XG5cdFx0ZWxzZSBpZiAoIU51bWJlci5pc0ludGVnZXIocGFyYW1zLndpZCkgfHwgcGFyYW1zLndpZCA8IDEpIHtcblx0XHRcdHJlamVjdCh7XCJlcnJvclwiOiBcIkludmFsaWQgd2lkLCBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlci5cIn0pXG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0Y29uc3QgY3Vyc29yID0gZGIuY29sbGVjdGlvbihcIndvcmRfZGF0YVwiKS5maW5kT25lKHsgd2lkOiBwYXJhbXMud2lkIH0sIChlcnIsIGRvYykgPT4ge1xuXHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coXCJlcnJvciB3aXRoIHdpZCBsb29rdXBcIilcblx0XHRcdFx0XHRyZWplY3QoZXJyKVxuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICghZG9jIHx8ICFkb2MuaGFzT3duUHJvcGVydHkoXCJmZWF0dXJlc1wiKSkge1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKFwibm8gZG9jOlwiLCBkb2MpXG5cdFx0XHRcdFx0cmVqZWN0KFwid2lkIG5vdCBmb3VuZFwiKVxuXHRcdFx0XHR9XG5cdFx0XHRcdGxldCBmZWF0dXJlcyA9IGRvY1tcImZlYXR1cmVzXCJdXG5cdFx0XHRcdHRvX2V4Y2x1ZGUuZm9yRWFjaChlID0+IHtcblx0XHRcdFx0XHRpZiAoZmVhdHVyZXMuaGFzT3duUHJvcGVydHkoZSkpXG5cdFx0XHRcdFx0XHRkZWxldGUgZmVhdHVyZXNbZV1cblx0XHRcdFx0fSlcblx0XHRcdFx0cmVzb2x2ZSh7XG5cdFx0XHRcdFx0XCJ3aWRcIjogcGFyYW1zLndpZCxcblx0XHRcdFx0XHRcInJlc3VsdHNcIjogZmVhdHVyZXNcblx0XHRcdFx0fSlcblx0XHRcdH0pXG5cdFx0fVxuXHR9KVxufVxuZXhwb3J0IHsgd29yZExvb2t1cCB9Il19